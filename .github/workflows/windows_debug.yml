name: Debug Windows Build

on:
  workflow_dispatch:

jobs:
  build-debug:
    name: Windows Debug Build
    runs-on: windows-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
          cache: 'pip'
          
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
          pip install pyinstaller
          
      - name: Build with PyInstaller
        run: |
          python -m PyInstaller --clean --noconfirm TTD.spec
          
      - name: Debug and Move Artifact
        run: |
          $VERSION = python -c "from version import __version__; print(__version__)"
          Write-Host "--- DEBUG: LISTING ALL DIST FILES ---"
          if (Test-Path dist) {
              Get-ChildItem -Path dist -Recurse | Select-Object FullName
          } else {
              Write-Error "FATAL: dist directory does not exist!"
              exit 1
          }
          
          Write-Host "--- DEBUG: SEARCHING FOR TTD.EXE ---"
          $EXE_FILE = Get-ChildItem -Path dist -Filter TTD.exe -Recurse | Select-Object -First 1
          
          if ($EXE_FILE) {
              Write-Host "FOUND: $($EXE_FILE.FullName)"
              $TARGET = "dist/TTD-$VERSION-windows.exe"
              Move-Item -Path $EXE_FILE.FullName -Destination $TARGET -Force
              Write-Host "SUCCESS: Moved to $TARGET"
          } else {
              Write-Error "ERROR: TTD.exe not found in dist directory!"
              exit 1
          }
          
      - name: Upload Artifacts
        uses: actions/upload-artifact@v4
        with:
          name: TTD-windows-debug
          path: dist/*.exe
